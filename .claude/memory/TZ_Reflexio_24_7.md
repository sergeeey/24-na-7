# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: Reflexio 24/7
**–í–µ—Ä—Å–∏—è:** 2.0 | **–î–∞—Ç–∞:** 2026-02-25 | **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—á–∏–π –¥–æ–∫—É–º–µ–Ω—Ç

---

## 1. –ú–ò–°–°–ò–Ø –ò –¶–ï–õ–¨ –ü–†–û–î–£–ö–¢–ê

**Reflexio 24/7** ‚Äî AI-–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ 24 —á–∞—Å–∞ –≤ —Å—É—Ç–∫–∏, —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –∫ –≤–µ—á–µ—Ä—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ –∑–µ—Ä–∫–∞–ª–æ –¥–Ω—è.

### –¢—Ä–∏ —É—Ä–æ–≤–Ω—è –∑—Ä–µ–ª–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∞

| –£—Ä–æ–≤–µ–Ω—å | –ù–∞–∑–≤–∞–Ω–∏–µ | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|-----------|----------|
| L1 | –§–∏–∫—Å–∞—Ü–∏—è | ~85% | –ó–∞–ø–∏—Å—å ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è ‚Üí —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –¥–∞–π–¥–∂–µ—Å—Ç |
| L2 | –ü–æ–Ω–∏–º–∞–Ω–∏–µ | ~20% | –ü–∞—Ç—Ç–µ—Ä–Ω—ã, —ç–º–æ—Ü–∏–∏, —Ç–µ–º—ã, –∑–∞–¥–∞—á–∏, –∫–æ–ª–µ—Å–æ –±–∞–ª–∞–Ω—Å–∞ |
| L3 | –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–π –¥–≤–æ–π–Ω–∏–∫ | ~0% | PersonGraph, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |

**–¶–µ–ª—å –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –¢–ó:** –¥–æ–≤–µ—Å—Ç–∏ L1 –¥–æ 100%, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å L2 –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∑–∞–ª–æ–∂–∏—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç L3.

### North Star –º–µ—Ç—Ä–∏–∫–∞
> "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç –≤–µ—á–µ—Ä–Ω–∏–π –¥–∞–π–¥–∂–µ—Å—Ç –∏ —É–∑–Ω–∞—ë—Ç –æ —Å–µ–±–µ —á—Ç–æ-—Ç–æ –≤–∞–∂–Ω–æ–µ, —á–µ–≥–æ —Å–∞–º –Ω–µ –∑–∞–º–µ—á–∞–ª."

---

## 2. –¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (AS-IS)

### 2.1 –ü–æ–ª–Ω—ã–π Pipeline

```
[Pixel 9 Pro]
  AudioRecord (16kHz, PCM16, mono)
  ‚Üí webrtcvad (aggressiveness=2, 30ms frames, 2-—Å–µ–∫ —Ç–∏—à–∏–Ω–∞ = –∫–æ–Ω–µ—Ü —Å–µ–≥–º–µ–Ω—Ç–∞)
  ‚Üí VadSegmentWriter ‚Üí WAV —Ñ–∞–π–ª (filesDir/audio_records/)
  ‚Üí IngestWebSocketClient (ws://host:8000/ws/ingest, Binary frame)

[–°–µ—Ä–≤–µ—Ä: reflexio-api Docker]
  WebSocket handler (websocket.py)
  ‚Üí P0: SpeechFilter (FFT: speech 300-3400Hz vs music >4kHz, FILTER_MUSIC=true)
  ‚Üí Whisper medium (language=ru, CPU, int8)
  ‚Üí P1: _is_meaningful_transcription (min 3 —Å–ª–æ–≤–∞, –Ω–µ —Å—Ç–æ–ø-—Ñ—Ä–∞–∑—ã, lang_prob>0.4)
  ‚Üí Privacy pipeline (PRIVACY_MODE=audit, PII detection)
  ‚Üí persist_ws_transcription() ‚Üí SQLite: ingest_queue + transcriptions
  ‚Üí append_integrity_event() ‚Üí SQLite: integrity_events (SHA-256 chain)
  ‚Üí WAV —É–¥–∞–ª—ë–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (P2)
  ‚Üí JSON ‚Üí Android: {"type":"transcription","text":"...","file_id":"..."}
  ‚Üí Android: WAV —É–¥–∞–ª—ë–Ω –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (P3), enrichment –∑–∞–ø—Ä–æ—à–µ–Ω —á–µ—Ä–µ–∑ 3+5 —Å–µ–∫

  [Async] _enrich_and_persist():
    ‚Üí enrich_transcription() ‚Üí analyze_recording_text() ‚Üí LLM (gpt-4o-mini)
    ‚Üí persist_structured_event() ‚Üí SQLite: structured_events
    ‚Üí consolidate_to_memory_node() ‚Üí SQLite: memory_nodes

[Telegram Bot]
  22:50 ‚Üí /digest (daily digest generation)
  23:10 ‚Üí checkin (–≤–æ–ø—Ä–æ—Å –æ –¥–Ω–µ)
```

### 2.2 –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|-----------|
| Backend | Python 3.11, FastAPI, uvicorn |
| ASR | faster-whisper (medium, CPU, int8) |
| LLM | gpt-4o-mini (actor+critic), claude-haiku (enrichment) |
| DB (dev) | SQLite (D:/24 na 7/src/storage/recordings.db) |
| DB (prod) | Supabase (PostgreSQL) |
| Bot | Telegram (aiogram) |
| Android | Kotlin, Jetpack Compose, OkHttp WebSocket, Room |
| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | Pixel 9 Pro |
| GPU | NVIDIA RTX 5070 Ti (16GB VRAM) ‚Äî –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –¥–ª—è ASR |
| Deploy | Docker, docker-compose |
| Auth | Bearer token (API_KEY env), WebSocket header |
| Privacy | PII detection (PIIDetector), SHA-256 integrity chain |

### 2.3 –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLite)

```sql
-- –û—á–µ—Ä–µ–¥—å –≤—Ö–æ–¥—è—â–∏—Ö —Ñ–∞–π–ª–æ–≤
ingest_queue (
    id TEXT PK,           -- file_id (UUID, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è Android)
    filename TEXT,
    file_path TEXT,
    file_size INTEGER,
    status TEXT,          -- 'pending' | 'processed'
    created_at TEXT,
    processed_at TEXT,
    error_message TEXT
)

-- –°—ã—Ä—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –æ—Ç Whisper
transcriptions (
    id TEXT PK,
    ingest_id TEXT ‚Üí ingest_queue.id,
    text TEXT,
    language TEXT,
    language_probability REAL,
    duration REAL,
    segments TEXT,        -- JSON [{text,start,end,confidence}]
    created_at TEXT
)

-- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø–æ—Å–ª–µ LLM enrichment
structured_events (
    id TEXT PK,
    transcription_id TEXT ‚Üí transcriptions.id,
    timestamp TEXT,
    duration_sec REAL,
    text TEXT,
    language TEXT,
    summary TEXT,
    emotions TEXT,        -- JSON ["—Ä–∞–¥–æ—Å—Ç—å","—Ç—Ä–µ–≤–æ–≥–∞"]
    topics TEXT,          -- JSON ["—Ä–∞–±–æ—Ç–∞","–≤—Å—Ç—Ä–µ—á–∞"]
    tasks TEXT,           -- JSON [{text,priority,deadline}]
    decisions TEXT,       -- JSON ["—Ä–µ—à–µ–Ω–∏–µ 1"]
    speakers TEXT,        -- JSON [] (–≤—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ, –±—É–¥—É—â–µ–µ)
    urgency TEXT,         -- low|medium|high
    sentiment TEXT,       -- positive|neutral|negative
    location TEXT,        -- NULL (–≤—Å–µ–≥–¥–∞)
    asr_confidence REAL,
    enrichment_confidence REAL,
    enrichment_model TEXT,
    enrichment_tokens INTEGER,
    enrichment_latency_ms REAL,
    created_at TEXT
)

-- Legacy –∞–Ω–∞–ª–∏–∑—ã (—Å—Ç–∞—Ä—ã–π –ø—É—Ç—å)
recording_analyses (
    id TEXT PK,
    transcription_id TEXT,
    summary TEXT,
    emotions TEXT,        -- JSON
    actions TEXT,         -- JSON
    topics TEXT,          -- JSON
    urgency TEXT,
    created_at TEXT
)

-- Semantic memory nodes
memory_nodes (
    id TEXT PK,
    source_ingest_id TEXT,
    source_transcription_id TEXT,
    content TEXT,
    summary TEXT,
    topics_json TEXT,
    entities_json TEXT,
    created_at TEXT
)

-- Retrieval traces
retrieval_traces (
    id TEXT PK,
    query TEXT,
    node_ids_json TEXT,
    top_k INTEGER,
    created_at TEXT
)

-- Integrity hash chain
integrity_events (
    id TEXT PK,
    ingest_id TEXT,
    stage TEXT,           -- 'ingest_received' | 'transcription_complete' | ...
    content_hash TEXT,    -- SHA-256
    prev_hash TEXT,       -- —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π
    metadata TEXT,        -- JSON
    created_at TEXT
)
```

### 2.4 REST API (FastAPI)

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | / | Health + feature flags |
| GET | /health | Health check |
| WS | /ws/ingest | WebSocket: binary WAV ‚Üí transcription |
| POST | /ingest/audio | REST: multipart WAV upload |
| GET | /digest/daily?date=YYYY-MM-DD | –î–∞–π–¥–∂–µ—Å—Ç –¥–Ω—è (JSON) |
| GET | /digest/today | –î–∞–π–¥–∂–µ—Å—Ç —Å–µ–≥–æ–¥–Ω—è |
| GET | /digest/{date} | –î–∞–π–¥–∂–µ—Å—Ç –ø–æ –¥–∞—Ç–µ |
| GET | /digest/{date}/density | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å |
| GET | /asr/models | –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π ASR |
| POST | /asr/transcribe | –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª |
| GET | /memory/search?q=... | –ü–æ–∏—Å–∫ –≤ semantic memory |
| GET | /audit/trail/{ingest_id} | Integrity chain –æ—Ç—á—ë—Ç |
| GET | /search/transcriptions | –ü–æ–∏—Å–∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–π |
| GET | /metrics | –ú–µ—Ç—Ä–∏–∫–∏ (EXTENDED_METRICS=false ‚Üí —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ) |
| GET | /enrichment/{file_id} | Enrichment –¥–∞–Ω–Ω—ã–µ –ø–æ file_id |

### 2.5 Android (Pixel 9 Pro)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `AudioRecordingService` ‚Äî foreground service, `START_STICKY`, –∑–∞–ø–∏—Å—å 24/7
- `VadSegmentWriter` ‚Äî webrtcvad, 30ms frames, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è ‚Üí WAV
- `IngestWebSocketClient` ‚Äî OkHttp WebSocket, binary WAV, –ø–æ–ª—É—á–∞–µ—Ç JSON
- `EnrichmentApiClient` ‚Äî HTTP GET /enrichment/{file_id}, 2 –ø–æ–ø—ã—Ç–∫–∏ (3—Å + 5—Å)
- `RecordingDao` / `RecordingDatabase` ‚Äî Room, –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- `MainActivity` + Compose UI ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –¥–∞–π–¥–∂–µ—Å—Ç

**–ü—Ä–æ—Ç–æ–∫–æ–ª WebSocket:**
```
Android ‚Üí Server: [WAV bytes binary]
Server ‚Üí Android: {"type":"received","file_id":"uuid"}
Server ‚Üí Android: {"type":"transcription","text":"—Ç–µ–∫—Å—Ç","file_id":"uuid"}
    –ò–õ–ò: {"type":"filtered","file_id":"uuid"}  (—à—É–º/–º—É–∑—ã–∫–∞)
    –ò–õ–ò: {"type":"error","message":"..."}
```

---

## 3. –¢–ï–ö–£–©–ò–ï –ë–ê–ì–ò –ò –ü–†–û–ë–ï–õ–´

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É)

#### BUG-001: MAX_TEXT_LENGTH_FOR_LLM = 4000 ‚Äî Root Cause —Å–ª–æ–º–∞–Ω–Ω–æ–≥–æ CoD
**–§–∞–π–ª:** `src/digest/generator.py`
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª–∏–Ω–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ (>15 –º–∏–Ω—É—Ç) –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –¥–æ 4000 —Å–∏–º–≤–æ–ª–æ–≤.
Chain of Density –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí –ø—É—Å—Ç—ã–µ –∏–ª–∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ summary.
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–Ω—è—Ç—å –¥–æ 16000 (Claude Haiku –∫–æ–Ω—Ç–µ–∫—Å—Ç 200K), –¥–æ–±–∞–≤–∏—Ç—å tiered chunking:
- –°–Ω–∞—á–∞–ª–∞ summarize –∫–∞–∂–¥—ã–µ N –∑–∞–ø–∏—Å–µ–π –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü–æ—Ç–æ–º summary-of-summaries

#### BUG-002: –ö–∞–∑–∞—Ö—Å–∫–∏–π —è–∑—ã–∫ –º–æ–ª—á–∞ –ª–æ–º–∞–µ—Ç—Å—è
**–§–∞–π–ª:** `src/utils/config.py`, `src/asr/transcribe.py`
**–ü—Ä–æ–±–ª–µ–º–∞:** `ASR_LANGUAGE=ru` –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∫–∞–∑–∞—Ö—Å–∫–∏–π –∫–∞–∫ "—Ä—É—Å—Å–∫–∏–π" ‚Äî —Ç–µ–∫—Å—Ç –∫–æ–≤–µ—Ä–∫–∞–µ—Ç—Å—è, confidence 1.0 (–ª–æ–∂–Ω–æ-–≤—ã—Å–æ–∫–æ–µ).
**–†–µ—à–µ–Ω–∏–µ:** auto-detect (lang=None) + post-check: –µ—Å–ª–∏ detected_lang –≤ ["kk","ru"] ‚Äî accept, –∏–Ω–∞—á–µ discard.

#### BUG-003: –î–≤–µ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ pipeline
**–§–∞–π–ª—ã:** `websocket.py` + `src/api/routers/ingest.py`
**–ü—Ä–æ–±–ª–µ–º–∞:** REST POST /ingest/audio –∏ WebSocket –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏. –§–∏–∫—Å—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ WebSocket. REST –ø—É—Ç—å —Å–æ–¥–µ—Ä–∂–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –±–∞–≥–∏.
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ `src/core/audio_processing.py`, –æ–±–∞ —Ä–æ—É—Ç–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –º–æ–¥—É–ª—å.

#### BUG-004: GPU –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è ASR
**–ö–æ–Ω—Ñ–∏–≥:** `ASR_DEVICE=cpu`, RTX 5070 Ti –¥–æ—Å—Ç—É–ø–Ω–∞
**–í–ª–∏—è–Ω–∏–µ:** Whisper medium –Ω–∞ CPU ‚âà 5-10√ó —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–∞—Ö ‚Üí –æ—á–µ—Ä–µ–¥—å.
**–†–µ—à–µ–Ω–∏–µ:** `ASR_DEVICE=cuda`, `ASR_COMPUTE_TYPE=float16` –≤ Docker (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ GPU passthrough).

#### BUG-005: CoreMemory —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.cursor/` –ø–∞–ø–∫–µ
**–§–∞–π–ª:** `D:/24 na 7/.cursor/memory/core_memory.json`
**–ü—Ä–æ–±–ª–µ–º–∞:** –£–¥–∞–ª–µ–Ω–∏–µ Cursor IDE = –ø–æ—Ç–µ—Ä—è core memory. –ù–µ –≤ git-tracked path.
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `D:/24 na 7/src/storage/core_memory.json`.

### üü° –í–∞–∂–Ω—ã–µ (–¥–µ–≥—Ä–∞–¥–∏—Ä—É—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ)

#### BUG-006: –°—Ç–æ–ø-—Ñ—Ä–∞–∑—ã —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
**–§–∞–π–ª:** `websocket.py`, `enricher.py`
`_NOISE_PHRASES` –∏ `WHISPER_HALLUCINATIONS` –Ω–µ –≤–∫–ª—é—á–∞—é—Ç —Ä—É—Å—Å–∫–∏–µ —à—É–º—ã:
`"—É–≥—É"`, `"–∞–≥–∞"`, `"–Ω—É"`, `"–º–º"`, `"—ç—Ç–æ"`, `"—Ç–∞–∫"`, `"–ª–∞–¥–Ω–æ"`
‚Üí –ú—É—Å–æ—Ä –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ë–î –∏ –ø–æ—Ä—Ç–∏—Ç –¥–∞–π–¥–∂–µ—Å—Ç.

#### BUG-007: 2-—Å–µ–∫—É–Ω–¥–Ω—ã–π silence VAD —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É
**–§–∞–π–ª:** `android/.../VadSegmentWriter.kt`
**–ü—Ä–æ–±–ª–µ–º–∞:** "–Ø –¥—É–º–∞—é... [2.1 —Å–µ–∫ –ø–∞—É–∑–∞] ...—á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞–≤—Ç—Ä–∞" ‚Üí –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–∞. Enrichment —Ç–µ—Ä—è–µ—Ç —Å–≤—è–∑—å –º–µ–∂–¥—É –º—ã—Å–ª—è–º–∏.
**–†–µ—à–µ–Ω–∏–µ:** Extend silence –¥–æ 3-4 —Å–µ–∫—É–Ω–¥ + merge-–±–ª–∏–∑–∫–∏–µ-—Å–µ–≥–º–µ–Ω—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ –¥–≤–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ < 5 —Å–µ–∫ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ ‚Üí join).

#### BUG-008: enrichment_confidence –≤—Å–µ–≥–¥–∞ 0.8
**–§–∞–π–ª:** `src/enrichment/enricher.py` —Å—Ç—Ä–æ–∫–∞ 117
`base_event.enrichment_confidence = 0.8` ‚Äî hardcoded. –ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏.
**–†–µ—à–µ–Ω–∏–µ:** confidence = f(summary length, topics count, sentiment‚â†neutral).

#### BUG-009: Async enrichment –±–µ–∑ retry
**–§–∞–π–ª:** `websocket.py` ‚Äî `_enrich_and_persist()`
–ï—Å–ª–∏ LLM –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É (—Ç–∞–π–º–∞—É—Ç, rate limit) ‚Äî enrichment –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è.
–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ summary/topics.
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å retry —Å exponential backoff (3 –ø–æ–ø—ã—Ç–∫–∏, 2/4/8 —Å–µ–∫—É–Ω–¥).

#### BUG-010: SAFE checker warning –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
**–§–∞–π–ª:** `src/api/main.py` (middleware)
–ù–µ—Ç `src/validation/` –º–æ–¥—É–ª—è ‚Üí –∏–º–ø–æ—Ä—Ç –ø–∞–¥–∞–µ—Ç —Å warning –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å `src/validation/safe_checker.py` –∏–ª–∏ —É–±—Ä–∞—Ç—å warning.

#### BUG-011: DigestGenerator –±–µ—Ä—ë—Ç –ü–û–°–õ–ï–î–ù–ò–ï N –∑–∞–ø–∏—Å–µ–π, –Ω–µ –í–°–ï
**–§–∞–π–ª:** `src/digest/generator.py`
`MAX_TRANSCRIPTIONS_FOR_LLM=100` –±–µ—Ä—ë—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100. –ï—Å–ª–∏ –∑–∞ –¥–µ–Ω—å 150 –∑–∞–ø–∏—Å–µ–π ‚Äî –ø–µ—Ä–≤–∞—è —Ç—Ä–µ—Ç—å –¥–Ω—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.
**–†–µ—à–µ–Ω–∏–µ:** Tiered approach: —Å–Ω–∞—á–∞–ª–∞ summarize –∫–∞–∂–¥—ã–π —á–∞—Å –æ—Ç–¥–µ–ª—å–Ω–æ, –ø–æ—Ç–æ–º –¥–Ω–µ–≤–Ω–æ–π –¥–∞–π–¥–∂–µ—Å—Ç –∏–∑ —á–∞—Å–æ–≤—ã—Ö summary.

#### BUG-012: topics[] —Å–º–µ—à–∏–≤–∞–µ—Ç —Ç–µ–º—ã –∏ –¥–æ–º–µ–Ω—ã
**–¢–µ–∫—É—â–µ–µ:** `topics = ["—Ä–∞–±–æ—Ç–∞", "–≤—Å—Ç—Ä–µ—á–∞", "–∑–¥–æ—Ä–æ–≤—å–µ", "–±–µ–≥", "—Å–µ–º—å—è"]`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å "–≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ –∑–¥–æ—Ä–æ–≤—å–µ" vs "–≤—Å–µ –≤—Å—Ç—Ä–µ—á–∏ –ø—Ä–æ —Ä–∞–±–æ—Ç—É".
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ `topics[]` (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ: "–≤—Å—Ç—Ä–µ—á–∞ —Å –ò–≤–∞–Ω–æ–º") –∏ `domains[]` (8 –¥–æ–º–µ–Ω–æ–≤: work/health/family/finance/psychology/relations/growth/leisure).

#### BUG-013: Semantic memory ‚Äî —Ç–æ–ª—å–∫–æ LIKE-–ø–æ–∏—Å–∫
**–§–∞–π–ª:** `src/memory/semantic_memory.py`
`retrieve_memory()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `WHERE lower(content) LIKE ?` ‚Äî –Ω–µ—Ç —Å–º—ã—Å–ª–æ–≤—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.
**–†–µ—à–µ–Ω–∏–µ:** Stage-2 –ø–∞–º—è—Ç—å: text-embedding-3-small (1536 dim) ‚Üí pgvector –≤ Supabase.

#### BUG-014: Android enrichment fetch ‚Äî —Ç–æ–ª—å–∫–æ 2 –ø–æ–ø—ã—Ç–∫–∏
**–§–∞–π–ª:** `AudioRecordingService.kt`
–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω ‚Üí enrichment –Ω–µ –ø—Ä–∏–¥—ë—Ç –Ω–∞ Android.
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å background sync job (WorkManager) –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç.

#### BUG-015: –ù–µ—Ç offline queue –Ω–∞ Android
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ Wi-Fi –Ω–µ—Ç ‚Üí —Å–µ–≥–º–µ–Ω—Ç—ã —Ç–µ—Ä—è—é—Ç—Å—è (WAV –∑–∞–ø–∏—Å–∞–Ω, upload failed, retry –Ω–µ—Ç).
**–†–µ—à–µ–Ω–∏–µ:** Room queue + WorkManager –¥–ª—è retry when network available.

### üü¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥

- 54 `.md` —Ñ–∞–π–ª–∞ –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–º—É—Å–æ—Ä)
- `android/.gradle/` –Ω–µ –≤ `.gitignore`
- `config/asr.yaml` `local.device: cuda` –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç `Settings.ASR_DEVICE=cpu`
- `config/asr.yaml` `model: whisper-v3-turbo` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (settings –±–µ—Ä—ë—Ç `ASR_MODEL_SIZE`)
- –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ —Ç–∞–±–ª–∏—Ü—ã (—Å–æ–∑–¥–∞–Ω endpoint `/metrics` –Ω–æ –Ω–µ—Ç CREATE TABLE)
- Supabase RLS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (READ/WRITE –æ—Ç–∫—Ä—ã—Ç—ã)
- `src:/app/src` volume mount –≤ Docker ‚Äî –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ production
- –ù–µ—Ç rate limiting –≤ WebSocket (—Ç–æ–ª—å–∫–æ REST)
- –ù–µ—Ç circuit breaker –¥–ª—è LLM –≤—ã–∑–æ–≤–æ–≤

---

## 4. –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò (–ü–†–ò–û–†–ò–¢–ï–¢–´)

### 4.1 –°–ø—Ä–∏–Ω—Ç 1: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è Core (1-2 –Ω–µ–¥–µ–ª–∏)

#### –ó–∞–¥–∞—á–∞ 1.1: Fix CoD ‚Äî –ø–æ–¥–Ω—è—Ç—å MAX_TEXT_LENGTH_FOR_LLM
```python
# –¢–µ–∫—É—â–µ–µ: MAX_TEXT_LENGTH_FOR_LLM = 4000
# –ù—É–∂–Ω–æ: tiered chunking
# 1) –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å transcriptions –ø–æ —á–∞—Å–∞–º
# 2) Summarize –∫–∞–∂–¥—ã–π —á–∞—Å (LLM #1)
# 3) Daily digest –∏–∑ hourly summaries (LLM #2)
```
**–§–∞–π–ª:** `src/digest/generator.py`
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** CoD —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–π –¥–ª–∏–Ω—ã –¥–Ω—è.

#### –ó–∞–¥–∞—á–∞ 1.2: –†—É—Å—Å–∫–∏–µ —Å—Ç–æ–ø-—Ñ—Ä–∞–∑—ã
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ _NOISE_PHRASES:
RU_NOISE = {"—É–≥—É", "–∞–≥–∞", "–Ω—É", "–º–º", "—Ö–º", "—ç—Ç–æ", "–ª–∞–¥–Ω–æ", "–ø–æ–Ω—è–ª", "–æ–∫–µ–π"}
# –î–æ–±–∞–≤–∏—Ç—å –≤ WHISPER_HALLUCINATIONS:
RU_HALLUCINATIONS = {"—Å–ø–∞—Å–∏–±–æ.", "—Å–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä.", "–ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å."}
```
**–§–∞–π–ª—ã:** `websocket.py`, `enricher.py`

#### –ó–∞–¥–∞—á–∞ 1.3: –†–∞–∑–¥–µ–ª–∏—Ç—å topics[] –∏ domains[]
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É domains TEXT DEFAULT '[]' –≤ structured_events
-- –ó–∞–ø–æ–ª–Ω—è—Ç—å —á–µ—Ä–µ–∑ DomainClassifier (—Å–º. —Ä–∞–∑–¥–µ–ª 5)
```

#### –ó–∞–¥–∞—á–∞ 1.4: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ CoreMemory
```bash
mv .cursor/memory/core_memory.json src/storage/core_memory.json
# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã
```

#### –ó–∞–¥–∞—á–∞ 1.5: –°–æ–∑–¥–∞—Ç—å src/validation/safe_checker.py
–£–±—Ä–∞—Ç—å warning –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

#### –ó–∞–¥–∞—á–∞ 1.6: Unified audio processing pipeline
–í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É WebSocket + REST –≤ `src/core/audio_processing.py`.

### 4.2 –°–ø—Ä–∏–Ω—Ç 2: –ö–∞—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞ (2-4 –Ω–µ–¥–µ–ª–∏)

#### –ó–∞–¥–∞—á–∞ 2.1: –†–µ–∞–ª—å–Ω—ã–π enrichment_confidence
```python
def compute_enrichment_confidence(analysis: dict) -> float:
    score = 0.0
    if len(analysis.get("summary", "")) > 30: score += 0.3
    if len(analysis.get("topics", [])) >= 2: score += 0.2
    if len(analysis.get("emotions", [])) >= 1: score += 0.2
    if analysis.get("urgency") != "medium": score += 0.15
    if len(analysis.get("actions", [])) >= 1: score += 0.15
    return round(min(score, 1.0), 2)
```

#### –ó–∞–¥–∞—á–∞ 2.2: Retry –¥–ª—è async enrichment
```python
async def _enrich_and_persist(ingest_id, text, ...):
    for attempt in range(3):
        try:
            result = await enrich_transcription(...)
            break
        except Exception:
            await asyncio.sleep(2 ** attempt)
```

#### –ó–∞–¥–∞—á–∞ 2.3: Segment merging –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
–ï—Å–ª–∏ –¥–≤–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ –ø—Ä–∏—à–ª–∏ < 5 —Å–µ–∫—É–Ω–¥ –¥—Ä—É–≥ –∑–∞ –¥—Ä—É–≥–æ–º –æ—Ç –æ–¥–Ω–æ–≥–æ WS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Üí –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ø–µ—Ä–µ–¥ enrichment.

#### –ó–∞–¥–∞—á–∞ 2.4: ASR language auto-detect + validation
```python
# –ù–µ ASR_LANGUAGE=ru –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –∞:
segments, info = model.transcribe(audio, language=None)
if info.language not in ["ru", "kk", "en"]:
    return None  # Reject
```

#### –ó–∞–¥–∞—á–∞ 2.5: Android offline queue (WorkManager)
```kotlin
// RecordingUploadWorker extends CoroutineWorker
// Constraints: NetworkType.CONNECTED
// Input: recordingId
// Retry policy: exponential, max 3 attempts
```

### 4.3 –°–ø—Ä–∏–Ω—Ç 3: –ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞ (1 –º–µ—Å—è—Ü)

–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∞ –≤ **—Ä–∞–∑–¥–µ–ª–µ 5**.

### 4.4 –°–ø—Ä–∏–Ω—Ç 4: Stage-2 –ü–∞–º—è—Ç—å (2 –º–µ—Å—è—Ü–∞)

–í–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ + PersonGraph ‚Äî –æ–ø–∏—Å–∞–Ω –≤ **—Ä–∞–∑–¥–µ–ª–µ 6**.

---

## 5. –ö–û–õ–ï–°–û –ë–ê–õ–ê–ù–°–ê

### 5.1 –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

Wheel of Balance (–í–æ–ë) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –ø–æ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º –¥–æ–º–µ–Ω–∞–º –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∂–∏–∑–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** –¥–æ–º–µ–Ω—ã —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ ‚Üí –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞.
–°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ 8 –¥–æ–º–µ–Ω–æ–≤, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏.

### 5.2 –î–æ–º–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è –°–µ—Ä–≥–µ—è)

| –î–æ–º–µ–Ω | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–ø—Ä–∏–º–µ—Ä—ã) | –ò–∫–æ–Ω–∫–∞ |
|-------|------------------------|--------|
| `work` | —Ä–∞–±–æ—Ç–∞, –∑–∞–¥–∞—á–∞, –≤—Å—Ç—Ä–µ—á–∞, –ø—Ä–æ–µ–∫—Ç, –∫–ª–∏–µ–Ω—Ç, –¥–µ–¥–ª–∞–π–Ω, –±–∞–Ω–∫, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | üíº |
| `health` | –∑–¥–æ—Ä–æ–≤—å–µ, –±–µ–≥, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞, –µ–¥–∞, —Å–æ–Ω, –≤—Ä–∞—á, —É—Å—Ç–∞–ª–æ—Å—Ç—å, –±–æ–ª–∏—Ç | üèÉ |
| `family` | –∂–µ–Ω–∞, –¥–µ—Ç–∏, –º–∞–º–∞, –ø–∞–ø–∞, –¥–æ–º, —É–∂–∏–Ω, –≤—ã—Ö–æ–¥–Ω—ã–µ, –ê–ª–º–∞—Ç—ã | üë®‚Äçüë©‚Äçüë¶ |
| `finance` | –¥–µ–Ω—å–≥–∏, –∑–∞—Ä–ø–ª–∞—Ç–∞, —Ä–∞—Å—Ö–æ–¥—ã, –∫—Ä–µ–¥–∏—Ç, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, —Ç–µ–Ω–≥–µ | üí∞ |
| `psychology` | —á—É–≤—Å—Ç–≤—É—é, —Ç—Ä–µ–≤–æ–≥–∞, —Å—Ç—Ä–µ—Å—Å, —Ä–∞–¥–æ—Å—Ç—å, –∑–ª–æ—Å—Ç—å, –¥—É–º–∞—é, –æ—Å–æ–∑–Ω–∞–ª | üß† |
| `relations` | –¥—Ä—É–∑—å—è, –∫–æ–ª–ª–µ–≥–∏, –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –æ–±—â–µ–Ω–∏–µ, –¥–æ–≤–µ—Ä–∏–µ | ü§ù |
| `growth` | —É—á—É—Å—å, –∫–Ω–∏–≥–∞, –∫—É—Ä—Å, –∏–¥–µ—è, —Ü–µ–ª—å, —Ä–∞–∑–≤–∏—Ç–∏–µ, –Ω–∞–≤—ã–∫ | üå± |
| `leisure` | –æ—Ç–¥—ã—Ö, –∫–∏–Ω–æ, –∏–≥—Ä–∞, –ø—Ä–æ–≥—É–ª–∫–∞, —Ö–æ–±–±–∏, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ, –º—É–∑—ã–∫–∞ | üéØ |

### 5.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ DomainClassifier

```python
# src/balance/domain_classifier.py

class DomainClassifier:
    """–ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ –¥–æ–º–µ–Ω–∞–º –∫–æ–ª–µ—Å–∞ –±–∞–ª–∞–Ω—Å–∞."""

    def classify(self, text: str, topics: list[str]) -> list[str]:
        """
        Returns: —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ ['work', 'health']

        –õ–æ–≥–∏–∫–∞ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞):
        1. Exact match: topics[] —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–º–µ–Ω-–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
        2. Keyword match: text —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–æ–º–µ–Ω–∞
        3. LLM fallback: –µ—Å–ª–∏ confidence < 0.6, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ LLM
        """
        ...
```

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –≤ structured_events:
ALTER TABLE structured_events ADD COLUMN domains TEXT DEFAULT '[]';

-- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–æ–≤
CREATE TABLE domain_config (
    id TEXT PRIMARY KEY,
    domain TEXT NOT NULL,        -- 'work', 'health', 'custom_domain'
    display_name TEXT NOT NULL,  -- '–†–∞–±–æ—Ç–∞', '–ó–¥–æ—Ä–æ–≤—å–µ', '–ú–æ–π –±–∏–∑–Ω–µ—Å'
    keywords_json TEXT,          -- JSON ["—Å–ª–æ–≤–æ1", "—Å–ª–æ–≤–æ2"]
    color TEXT DEFAULT '#6366f1',
    icon TEXT DEFAULT 'üìå',
    is_active BOOLEAN DEFAULT true,
    created_at TEXT
);

-- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –¥–æ–º–µ–Ω–∞–º –¥–ª—è –∫–æ–ª–µ—Å–∞
CREATE VIEW domain_balance AS
SELECT
    date(created_at) as day,
    domain,
    COUNT(*) as mention_count,
    AVG(CASE WHEN sentiment='positive' THEN 1
             WHEN sentiment='negative' THEN -1
             ELSE 0 END) as avg_sentiment
FROM structured_events, json_each(domains)
GROUP BY day, domain;
```

### 5.4 API –¥–ª—è –∫–æ–ª–µ—Å–∞ –±–∞–ª–∞–Ω—Å–∞

```
GET /balance/wheel?date=YYYY-MM-DD
GET /balance/wheel?from=YYYY-MM-DD&to=YYYY-MM-DD
GET /balance/domains                    -- —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /balance/domains                   -- –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω
PUT /balance/domains/{domain}           -- –∏–∑–º–µ–Ω–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
GET /balance/insights                   -- AI-–∞–Ω–∞–ª–∏–∑ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞
```

**–û—Ç–≤–µ—Ç GET /balance/wheel:**
```json
{
  "date": "2026-02-25",
  "domains": [
    {"domain": "work", "score": 8.2, "mentions": 47, "sentiment": -0.2},
    {"domain": "health", "score": 1.1, "mentions": 3, "sentiment": 0.1},
    {"domain": "family", "score": 2.3, "mentions": 8, "sentiment": 0.5}
  ],
  "balance_score": 0.34,
  "alert": "–°–µ–≥–æ–¥–Ω—è —Ä–∞–±–æ—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 78% –¥–Ω—è. –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –æ –∑–¥–æ—Ä–æ–≤—å–µ ‚Äî 3 –¥–Ω—è –Ω–∞–∑–∞–¥.",
  "recommendation": "–ó–∞–≤—Ç—Ä–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä—É–π 30 –º–∏–Ω—É—Ç –¥–ª—è —Å–µ–±—è."
}
```

### 5.5 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –¥–∞–π–¥–∂–µ—Å—Ç

```markdown
## –ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞ ‚Äî 25 —Ñ–µ–≤—Ä–∞–ª—è

üíº –†–∞–±–æ—Ç–∞       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 8.2/10 (48 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π)
üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è   ‚ñà‚ñà‚ñà‚ñà         3.1/10 (12 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π)
üë®‚Äçüë©‚Äçüë¶ –°–µ–º—å—è        ‚ñà‚ñà‚ñà          2.3/10 (8 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π)
üèÉ –ó–¥–æ—Ä–æ–≤—å–µ     ‚ñà            1.1/10 (3 —É–ø–æ–º–∏–Ω–∞–Ω–∏—è)

‚ö†Ô∏è –î–∏—Å–±–∞–ª–∞–Ω—Å: –ó–¥–æ—Ä–æ–≤—å–µ ‚Äî 4 –¥–Ω—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
```

---

## 6. –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ô –ì–†–ê–§ (PERSONALGRAPH) ‚Äî –ü–õ–ê–ù L3

### 6.1 –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

PersonGraph ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –∫—Ç–æ –æ–Ω, –∫–∞–∫ –¥—É–º–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º.

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ)
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ –∫–æ–ª–µ—Å–∞ –±–∞–ª–∞–Ω—Å–∞
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã
- –ó–∞–¥–∞—á–∏ (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã/–Ω–µ—Ç)

### 6.2 –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–∞—Ä–∫–µ—Ä—ã (LIWC-–ø–æ–¥–æ–±–Ω—ã–µ)

| –ú–∞—Ä–∫–µ—Ä | –°–∏–≥–Ω–∞–ª—ã | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|--------|---------|---------------|
| –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å | —Å–ª–æ–≤–∞ "–≤—Å–µ–≥–¥–∞", "–Ω–∏–∫–æ–≥–¥–∞", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ", "—Å—Ç—Ä–∞—à–Ω–æ" | –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∞—Ü–∏—è |
| –°–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∞ | "—è –ø–ª–æ—Ö–æ", "–æ–ø—è—Ç—å —è", "—Å–Ω–æ–≤–∞ –Ω–µ —Å–º–æ–≥" | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—Ä–∏—Ç–∏–∫ |
| –ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º | "–Ω–∞–¥–æ –ª—É—á—à–µ", "–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ", "–Ω–µ –≥–æ—Ç–æ–≤–æ" | Blockers –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π |
| –ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è | "–ø–æ—Ç–æ–º", "–∑–∞–≤—Ç—Ä–∞", "–µ—â—ë –Ω–µ" + deadline –ø—Ä–æ–ø—É—â–µ–Ω | –ü–∞—Ç—Ç–µ—Ä–Ω –æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è |
| –≠–Ω–µ—Ä–≥–∏—è | —Ç–µ–º–ø —Ä–µ—á–∏, –¥–ª–∏–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤, –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å | –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∑–∞—Ä—è–¥ |
| –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è | ‚â§2 —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ª—é–¥–µ–π –∑–∞ –Ω–µ–¥–µ–ª—é | –†–∏—Å–∫ –∏–∑–æ–ª—è—Ü–∏–∏ |

```python
# src/psychology/liwc_markers.py

ABSOLUTIST_WORDS = {"–≤—Å–µ–≥–¥–∞", "–Ω–∏–∫–æ–≥–¥–∞", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ", "–æ–±—è–∑–∞–Ω", "–¥–æ–ª–∂–µ–Ω"}
SELF_CRITICAL = {"–æ–ø—è—Ç—å —è", "—Å–Ω–æ–≤–∞ –Ω–µ", "–∫–∞–∫ –≤—Å–µ–≥–¥–∞ –ø–ª–æ—Ö–æ"}
PROCRASTINATION = {"–ø–æ—Ç–æ–º", "–∑–∞–≤—Ç—Ä–∞", "–∫–∞–∫-–Ω–∏–±—É–¥—å", "–µ—â—ë —É—Å–ø–µ—é"}

def analyze_linguistic_markers(text: str) -> dict:
    return {
        "absolutism_score": count_matches(text, ABSOLUTIST_WORDS) / word_count(text),
        "self_criticism_score": ...,
        "procrastination_signals": ...,
    }
```

### 6.3 Temporal Knowledge Graph (Graphiti/Zep –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

```python
# –£–∑–ª—ã GraphPersonal:
# Person (–°–µ—Ä–≥–µ–π)
# ‚Üí HAS_DOMAIN ‚Üí DomainBalance (work, health...)
# ‚Üí EXPERIENCED_EMOTION ‚Üí EmotionEvent (—Ç—Ä–µ–≤–æ–≥–∞, 2026-02-25)
# ‚Üí MENTIONED_TASK ‚Üí Task (uuid, created, completed?)
# ‚Üí HAS_PATTERN ‚Üí BehaviorPattern (procrastination, –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è –ø–æ –ø—è—Ç–Ω–∏—Ü–∞–º)
# ‚Üí KNOWS_PERSON ‚Üí Contact (–∫–æ–ª–ª–µ–≥–∞, –∂–µ–Ω–∞...)

# Edges –∏–º–µ—é—Ç timestamp ‚Üí –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å –∫–∞–∫ –≥—Ä–∞—Ñ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
```

**–°—Ç–µ–∫:** Graphiti (Python) + Supabase pgvector.

### 6.4 "100 –º—É–¥—Ä–µ—Ü–æ–≤" ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–Ω–∞–ª–∏–∑–∞

–í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ ‚Äî –∞–Ω—Å–∞–º–±–ª—å –∏–∑ 5 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤:

```python
ANALYSTS = {
    "psychologist": "–¢—ã –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–∞—Ç—Ç–µ—Ä–Ω—ã –º—ã—à–ª–µ–Ω–∏—è, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–∏–∫–ª—ã...",
    "coach": "–¢—ã ICF-–∫–æ—É—á. –§–æ–∫—É—Å –Ω–∞ –∑–∞–¥–∞—á–∞—Ö, –ø—Ä–æ–≥—Ä–µ—Å—Å–µ, blockers...",
    "pattern_detector": "–¢—ã –∞–Ω–∞–ª–∏—Ç–∏–∫ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤. –ò—â–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ç–µ–º—ã...",
    "devil_advocate": "–¢—ã –∫—Ä–∏—Ç–∏–∫. –ß—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç? –ß—Ç–æ –ª—å—Å—Ç–∏—Ç —Å–∞–º —Å–µ–±–µ?",
    "future_predictor": "–¢—ã —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –ö—É–¥–∞ –≤–µ–¥—É—Ç —Ç–µ–∫—É—â–∏–µ —Ç—Ä–µ–Ω–¥—ã?",
}

async def analyze_with_ensemble(day_text: str) -> MultiPerspectiveAnalysis:
    results = await asyncio.gather(*[
        call_analyst(role, prompt, day_text)
        for role, prompt in ANALYSTS.items()
    ])
    return synthesize_insights(results)
```

---

## 7. –ú–£–õ–¨–¢–ò-–°–ï–ù–°–û–†–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### 7.1 –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|--------|-----------|
| –ì–æ–ª–æ—Å (–æ—Å–Ω–æ–≤–Ω–æ–π) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚Äî |
| –£–º–Ω—ã–µ —á–∞—Å—ã (—à–∞–≥–∏, –ø—É–ª—å—Å, —Å–æ–Ω) | ‚ùå –ù–µ—Ç | HIGH |
| –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è | ‚ùå –ù–µ—Ç | MEDIUM |
| –¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ (meta, –Ω–µ –∫–æ–Ω—Ç–µ–Ω—Ç) | ‚ùå –ù–µ—Ç | MEDIUM |
| Calendar —Å–æ–±—ã—Ç–∏—è | ‚ùå –ù–µ—Ç | HIGH |
| Whisper prosody (openSMILE) | ‚ùå –ù–µ—Ç | HIGH |

### 7.2 Google Fit / Health Connect API (Android)

```kotlin
// HealthConnectClient
// Permissions: READ_STEPS, READ_HEART_RATE, READ_SLEEP_SESSION
// Sync –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ ‚Üí POST /health/metrics

data class DailyHealthMetrics(
    val date: String,
    val steps: Int,
    val avgHeartRate: Int,
    val sleepHours: Float,
    val stressLevel: Float?  // –∏–∑ –ø—É–ª—å—Å–∞ –≤–∞—Ä–∏–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
)
```

**–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ä–µ—á—å—é:**
```
Sleep < 6h ‚Üí —É—Ç—Ä–æ–º –±–æ–ª—å—à–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —ç–º–æ—Ü–∏–π? (–ø—Ä–æ–≤–µ—Ä—è–µ–º–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞)
Steps < 2000 ‚Üí –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Ä–µ—á–∏?
–ü—É–ª—å—Å > 100 –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ ‚Üí —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å?
```

### 7.3 openSMILE ‚Äî –ü—Ä–æ—Å–æ–¥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

```python
# –ê–Ω–∞–ª–∏–∑ –î–û —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–Ω–∞ —É—Ä–æ–≤–Ω–µ WAV —Ñ–∞–π–ª–∞):
# - Jitter (—Ç—Ä–µ–º–æ—Ä –≥–æ–ª–æ—Å–∞) ‚Üí —Ç—Ä–µ–≤–æ–≥–∞
# - Shimmer (–Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å –∞–º–ø–ª–∏—Ç—É–¥—ã) ‚Üí —É—Å—Ç–∞–ª–æ—Å—Ç—å
# - F0 (–æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–Ω) ‚Üí –≤–æ–ø—Ä–æ—Å vs —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
# - Speech rate ‚Üí –≤–æ–∑–±—É–∂–¥—ë–Ω–Ω–æ—Å—Ç—å

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑:
pip install opensmile
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ pipeline:**
```
WAV ‚Üí P0: SpeechFilter ‚Üí openSMILE ‚Üí prosody_features ‚Üí Whisper ‚Üí enrichment
                                           ‚Üì
                         structured_events.prosody_json = {...}
```

### 7.4 Calendar Integration

```python
# Google Calendar API ‚Üí –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–Ω—è
# ‚Üí –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç enrichment:
# "–°–µ–≥–æ–¥–Ω—è: 09:00 Standup, 14:00 –í—Å—Ç—Ä–µ—á–∞ —Å CEO, 18:00 –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞"
# ‚Üí LLM –≤–∏–¥–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí –ª—É—á—à–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç
```

---

## 8. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï

### 8.1 ASR –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–¢–µ–∫—É—â–µ–µ:** Whisper medium, CPU, int8
**–ü—Ä–æ–±–ª–µ–º–∞:** ~5-10√ó —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ = 30-—Å–µ–∫ —Å–µ–≥–º–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è 3-6 –º–∏–Ω—É—Ç

**–û–ø—Ü–∏–∏ (–æ—Ç –ª—É—á—à–µ–≥–æ –∫ –±—ã—Å—Ç—Ä–æ–º—É):**

| –í–∞—Ä–∏–∞–Ω—Ç | WER | –°–∫–æ—Ä–æ—Å—Ç—å | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|---------|-----|----------|-----------|
| Whisper medium, CPU int8 | ~8% (ru) | ~5-10x | –¢–µ–∫—É—â–µ–µ |
| Whisper medium, RTX 5070 Ti | ~8% (ru) | ~50x | GPU passthrough Docker |
| Whisper large-v3, GPU | ~5% (ru) | ~25x | GPU + 8GB VRAM |
| WhisperX large-v3 + diarization | ~5% + speaker ID | ~20x | GPU + 10GB VRAM |
| Parakeet v2 (nvidia) | ~3% (en only) | ~100x | GPU, only English |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ GPU –≤ Docker:
```yaml
# docker-compose.yml
services:
  api:
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    environment:
      - ASR_DEVICE=cuda
      - ASR_COMPUTE_TYPE=float16
      - ASR_MODEL_SIZE=large-v3
```

### 8.2 LLM –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–¢–µ–∫—É—â–µ–µ:** gpt-4o-mini –¥–ª—è enrichment (–∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç) + digest

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ 50+ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö/–¥–µ–Ω—å = $0.50-2.00/–¥–µ–Ω—å —Ç–æ–ª—å–∫–æ –Ω–∞ enrichment

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- Batching: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å 5-10 –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –æ–¥–∏–Ω LLM –∑–∞–ø—Ä–æ—Å
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤: –µ—Å–ª–∏ —Ç–æ–ø–∏–∫ —É–∂–µ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è ‚Üí re-use
- Claude Haiku –≤–º–µ—Å—Ç–æ gpt-4o-mini (–≤ 3√ó –¥–µ—à–µ–≤–ª–µ, —Å—Ä–∞–≤–Ω–∏–º–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –∫—Ä–∞—Ç–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤)
- Digest: –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N –º–∞–ª–µ–Ω—å–∫–∏—Ö

### 8.3 Database

**SQLite –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- WAL mode –≤–∫–ª—é—á–∏—Ç—å: `PRAGMA journal_mode=WAL`
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `created_at` (—É–∂–µ –µ—Å—Ç—å), –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ `sentiment`, `urgency`, `domains`
- –î–ª—è production: Supabase (pgvector –¥–ª—è Stage-2 –ø–∞–º—è—Ç–∏)

---

## 9. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ü–†–ò–í–ê–¢–ù–û–°–¢–¨

### 9.1 –£—Ä–æ–≤–Ω–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

| –†–µ–∂–∏–º | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------|---------|-------------------|
| `strict` | –ë–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å —Å PII | –ü—É–±–ª–∏—á–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ |
| `mask` | –ú–∞—Å–∫–∏—Ä—É–µ—Ç PII: "–ò–≤–∞–Ω" ‚Üí "[PERSON]" | –†–∞–±–æ—á–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã |
| `audit` | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª + –ª–æ–≥–∏—Ä—É–µ—Ç PII | –õ–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |

**–¢–µ–∫—É—â–µ–µ:** PRIVACY_MODE=audit ‚úÖ

### 9.2 Integrity Chain

SHA-256 hash chain –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–º–µ–Ω—ã –¥–∞–Ω–Ω—ã—Ö
- Audit trail –¥–ª—è –∫–∞–∂–¥–æ–≥–æ ingest_id

**–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:** `integrity_events` —Ç–∞–±–ª–∏—Ü–∞. –î–æ—Å—Ç—É–ø: `GET /audit/trail/{ingest_id}`

### 9.3 –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ—Ç—Å—è (–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

- ‚ùå –ë–∏–æ–º–µ—Ç—Ä–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ–±–ª–∞–∫–æ
- ‚ùå –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (P2 —Å–µ—Ä–≤–µ—Ä + P3 —Ç–µ–ª–µ—Ñ–æ–Ω)
- ‚ùå –ò–ò–ù/–ë–ò–ù/–Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç –Ω–µ –≤ –ª–æ–≥–∞—Ö (PII detection)
- ‚ùå Supabase –∫–ª—é—á–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ env vars

### 9.4 Supabase RLS (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

```sql
-- –í–∫–ª—é—á–∏—Ç—å Row Level Security
ALTER TABLE transcriptions ENABLE ROW LEVEL SECURITY;
ALTER TABLE structured_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE memory_nodes ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
CREATE POLICY "user_own_data" ON transcriptions
    FOR ALL USING (auth.uid() = user_id);
```

---

## 10. ANDROID ROADMAP

### 10.1 –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| AudioRecordingService (foreground, VAD) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| IngestWebSocketClient | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| P3: —É–¥–∞–ª–µ–Ω–∏–µ WAV –ø–æ—Å–ª–µ upload | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| EnrichmentApiClient (2 –ø–æ–ø—ã—Ç–∫–∏) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| Room DB (Recording) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| Compose UI (—Å–ø–∏—Å–æ–∫, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞) | ‚úÖ –ë–∞–∑–æ–≤–æ–µ |
| Offline queue | ‚ùå –ù–µ—Ç |
| WorkManager background sync | ‚ùå –ù–µ—Ç |
| –ö–æ–ª–µ—Å–æ –±–∞–ª–∞–Ω—Å–∞ UI | ‚ùå –ù–µ—Ç |
| Push notifications | ‚ùå –ù–µ—Ç |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚ùå –ù–µ—Ç |

### 10.2 –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã Android

**P0: Offline queue + retry**
```kotlin
@Entity
data class PendingUpload(
    val id: Long = 0,
    val filePath: String,
    val createdAt: Long,
    var retryCount: Int = 0,
    var lastError: String? = null
)

// WorkManager job: NetworkType.CONNECTED, BATTERY_NOT_LOW
class UploadWorker(ctx: Context, params: WorkerParameters) : CoroutineWorker(ctx, params)
```

**P1: Wheel of Balance UI**
```kotlin
@Composable
fun BalanceWheelScreen() {
    // Spider chart (8 —Å–ø–∏—Ü)
    // Tap –Ω–∞ –¥–æ–º–µ–Ω ‚Üí –¥–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–µ–π
    // Weekly trend chart
}
```

**P2: Battery optimization**
```
–¢–µ–∫—É—â–µ–µ: delay(5) –º–µ–∂–¥—É —Ñ—Ä–µ–π–º–∞–º–∏ = –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π CPU
–ù—É–∂–Ω–æ: AudioRecord setPositionNotificationPeriod() –¥–ª—è callback-based —á—Ç–µ–Ω–∏—è
```

**P3: Notification —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**
```kotlin
// –û–±–Ω–æ–≤–∏—Ç—å notification: "Reflexio: 47 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∑–∞–ø–∏—Å–∞–Ω–æ, 3 –∑–∞–¥–∞—á–∏"
// –í–º–µ—Å—Ç–æ: "Recording audio in background‚Ä¶"
```

---

## 11. DAILY DIGEST ‚Äî –ü–û–õ–ù–ê–Ø –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø

### 11.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞

```markdown
# Reflexio –î–∞–π–¥–∂–µ—Å—Ç ‚Äî 25 —Ñ–µ–≤—Ä–∞–ª—è 2026

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
[CoD: 3-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, —Å—É—Ç—å –¥–Ω—è]

## –ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞
[Spider chart / text representation]
üíº –†–∞–±–æ—Ç–∞ 8.2/10 | üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è 3.1/10 | üèÉ –ó–¥–æ—Ä–æ–≤—å–µ 1.1/10 ...

## –ö–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã –¥–Ω—è
1. [—Ç–µ–º–∞] ‚Äî [–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
2. ...

## –≠–º–æ—Ü–∏–∏ –¥–Ω—è
–î–æ–º–∏–Ω–∏—Ä—É—é—â–∏–µ: [—Å–ø–∏—Å–æ–∫]
–¢—Ä–µ–Ω–¥: [–£—Ç—Ä–æ: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ ‚Üí –ü–æ—Å–ª–µ –æ–±–µ–¥–∞: —Å—Ç—Ä–µ—Å—Å ‚Üí –í–µ—á–µ—Ä: —Å–ø–æ–∫–æ–π–Ω–æ]

## –ó–∞–¥–∞—á–∏
### –£–ø–æ–º—è–Ω—É—Ç—ã–µ —Å–µ–≥–æ–¥–Ω—è:
- [ ] –∑–∞–¥–∞—á–∞ 1 (urgent)
- [ ] –∑–∞–¥–∞—á–∞ 2

### –í—á–µ—Ä–∞—à–Ω–∏–µ (–Ω–µ –∑–∞–∫—Ä—ã—Ç—ã):
- [ ] –∑–∞–¥–∞—á–∞ –∏–∑ –≤—á–µ—Ä–∞

## –ò–Ω—Å–∞–π—Ç—ã (–æ—Ç 100 –º—É–¥—Ä–µ—Ü–æ–≤)
> [–ü—Å–∏—Ö–æ–ª–æ–≥]: –¢—ã —Å–µ–≥–æ–¥–Ω—è 3 —Ä–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–ª–æ–≤–æ "–¥–æ–ª–∂–µ–Ω" ‚Äî —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ –≤–Ω–µ—à–Ω–µ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è.
> [–ö–æ—É—á]: –ò–∑ 8 –∑–∞–¥–∞—á –æ–∑–≤—É—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ 1 —Å –¥–µ–¥–ª–∞–π–Ω–æ–º.
> [–ö—Ä–∏—Ç–∏–∫]: –¢—ã –≥–æ–≤–æ—Ä–∏–ª —á—Ç–æ "–≤—Å—ë —Ö–æ—Ä–æ—à–æ" –Ω–æ —Ç–æ–Ω –≥–æ–ª–æ—Å–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç.

## –ú–æ–º–µ–Ω—Ç –¥–Ω—è
[–°–∞–º–∞—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞—Å—ã—â–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–Ω—è]

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞
[–û–¥–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ]
```

### 11.2 –ê–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (tiered)

```python
async def generate_daily_digest(date: date) -> DigestResult:
    # Step 1: –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ transcriptions –∑–∞ –¥–µ–Ω—å
    all_records = get_day_records(date)  # –±–µ–∑ –ª–∏–º–∏—Ç–∞ 100

    # Step 2: Hourly summaries (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
    hours = group_by_hour(all_records)
    hourly_summaries = await asyncio.gather(*[
        summarize_hour(records, hour)
        for hour, records in hours.items()
    ])

    # Step 3: Domain analysis
    domain_stats = DomainClassifier().analyze_day(all_records)

    # Step 4: Linguistic markers
    psych_analysis = analyze_linguistic_markers(all_text)

    # Step 5: Daily digest –∏–∑ hourly summaries (–Ω–µ –∏–∑ —Å—ã—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π)
    digest = await generate_cod_digest(
        hourly_summaries=hourly_summaries,
        domain_stats=domain_stats,
        psych_analysis=psych_analysis,
        model="claude-3-haiku"
    )

    # Step 6: Critic validation
    validated = await critic_validate(digest)

    return validated
```

### 11.3 Endpoint –¥–ª—è Telegram –±–æ—Ç–∞

```python
# 22:50 ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
# GET /digest/daily?date=2026-02-25&format=telegram

# Telegram —Ñ–æ—Ä–º–∞—Ç: markdown –±–µ–∑ HTML, –ª–∏–º–∏—Ç 4096 —Å–∏–º–≤–æ–ª–æ–≤
# –ï—Å–ª–∏ > 4096 ‚Üí —Ä–∞–∑–±–∏–≤–∞—Ç—å –Ω–∞ 2-3 —Å–æ–æ–±—â–µ–Ω–∏—è
```

---

## 12. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

### 12.1 .env (production)

```env
# API
API_KEY=<strong-random-key>
API_HOST=0.0.0.0
API_PORT=8000

# ASR
ASR_MODEL_SIZE=large-v3
ASR_DEVICE=cuda
ASR_COMPUTE_TYPE=float16
ASR_LANGUAGE=  # –ø—É—Å—Ç–æ = auto-detect

# LLM
LLM_PROVIDER=anthropic
ANTHROPIC_API_KEY=<key>
LLM_MODEL_ACTOR=claude-3-haiku-20240307
LLM_MODEL_CRITIC=claude-3-haiku-20240307

# Storage
DB_BACKEND=supabase
SUPABASE_URL=<url>
SUPABASE_ANON_KEY=<key>
SUPABASE_SERVICE_KEY=<key>

# Filters
FILTER_MUSIC=true
FILTER_METHOD=fft

# Privacy
PRIVACY_MODE=audit
INTEGRITY_CHAIN_ENABLED=true

# Features
MEMORY_ENABLED=true
RETRIEVAL_ENABLED=true
EXTENDED_METRICS=true

# Bot
TELEGRAM_BOT_TOKEN=<token>
TELEGRAM_CHAT_ID=<chat_id>
```

### 12.2 docker-compose.yml (production)

```yaml
services:
  api:
    build: .
    container_name: reflexio-api
    ports: ["8000:8000"]
    env_file: [.env]
    environment:
      - FILTER_MUSIC=true
      - ASR_DEVICE=cuda
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    volumes:
      - ./src/storage:/app/src/storage
      - ./config:/app/config
      # –ù–ï –º–æ–Ω—Ç–∏—Ä—É–µ–º ./src:/app/src –≤ production
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    # –î–ª—è rate limiting (RATE_LIMIT_STORAGE=redis)
```

### 12.3 Android BuildConfig

```kotlin
// build.gradle.kts
buildConfigField("String", "SERVER_WS_URL", "\"ws://10.0.2.2:8000\"")
buildConfigField("String", "SERVER_WS_URL_DEVICE", "\"ws://192.168.1.X:8000\"")
buildConfigField("String", "SERVER_API_KEY", "\"${localProperties.getProperty("server.api.key", "")}\"")
```

---

## 13. –ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

### 13.1 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ KPI

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –¢–µ–∫—É—â–µ–µ |
|---------|------|---------|
| ASR WER (—Ä—É—Å—Å–∫–∏–π) | < 10% | ~8% (medium) |
| Enrichment latency | < 3 —Å–µ–∫ | ~1-2 —Å–µ–∫ |
| Noise filter FPR | < 2% | ~0% (–º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å) |
| Noise filter FNR | < 5% | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ |
| Digest generation time | < 30 —Å–µ–∫ | ~10-15 —Å–µ–∫ |
| Android crash rate | < 0.1% | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ |
| Upload success rate | > 99% | ~95% (–Ω–µ—Ç offline queue) |
| DB size/–¥–µ–Ω—å | < 50MB | ~5MB |

### 13.2 –ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–µ KPI

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å |
|---------|------|
| Digest read rate | > 80% –¥–Ω–µ–π |
| Digest action rate | ‚â• 1 –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–∑ –¥–∞–π–¥–∂–µ—Å—Ç–∞/–Ω–µ–¥–µ–ª—é |
| Balance wheel accuracy | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—Å–µ–Ω —Å 70%+ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–π |
| Insight "aha moment" | ‚â• 1 –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –∏–Ω—Å–∞–π—Ç/–Ω–µ–¥–µ–ª—é |

---

## 14. –§–ê–ô–õ–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
D:/24 na 7/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # FastAPI app, middleware, startup
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/                # auth, safe, input_guard
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ websocket.py           # Core WS pipeline (P0-P3)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ingest.py              # REST upload (needs sync with WS)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ digest.py              # Digest endpoints
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ memory.py              # /memory/search
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ audit.py               # /audit/trail
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ enrichment.py          # /enrichment/{file_id}
‚îÇ   ‚îú‚îÄ‚îÄ asr/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcribe.py              # Multi-provider ASR
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers.py               # OpenAI/WhisperX/Parakeet/Local
‚îÇ   ‚îú‚îÄ‚îÄ enrichment/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enricher.py                # enrich_transcription()
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.py                  # StructuredEvent Pydantic model
‚îÇ   ‚îú‚îÄ‚îÄ digest/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generator.py               # DigestGenerator (CoD + Critic)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analyzer.py                # InformationDensityAnalyzer
‚îÇ   ‚îú‚îÄ‚îÄ memory/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ semantic_memory.py         # memory_nodes CRUD + retrieval
‚îÇ   ‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ingest_persist.py          # SQLite: ingest_queue + transcriptions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ integrity.py               # SHA-256 hash chain
‚îÇ   ‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ privacy_pipeline.py        # PII detection (strict/mask/audit)
‚îÇ   ‚îú‚îÄ‚îÄ summarizer/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ few_shot.py                # analyze_recording_text()
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prompts.py                 # Prompt templates
‚îÇ   ‚îú‚îÄ‚îÄ llm/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers.py               # OpenAI/Anthropic/Gemini clients
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas/                   # Pydantic schemas –¥–ª—è LLM
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py                  # Settings (Pydantic BaseSettings)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.py                 # structlog setup
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ guardrails.py              # PIIDetector
‚îÇ   ‚îî‚îÄ‚îÄ storage/
‚îÇ       ‚îú‚îÄ‚îÄ uploads/                   # Temp WAV files (auto-deleted)
‚îÇ       ‚îú‚îÄ‚îÄ recordings/                # Processed files
‚îÇ       ‚îî‚îÄ‚îÄ recordings.db              # SQLite database
‚îÇ
‚îú‚îÄ‚îÄ android/
‚îÇ   ‚îî‚îÄ‚îÄ app/src/main/kotlin/com/reflexio/app/
‚îÇ       ‚îú‚îÄ‚îÄ domain/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ services/AudioRecordingService.kt   # Foreground service, VAD
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ network/IngestWebSocketClient.kt     # WS binary upload
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ network/EnrichmentApiClient.kt       # HTTP enrichment fetch
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ vad/VadSegmentWriter.kt              # webrtcvad wrapper
‚îÇ       ‚îú‚îÄ‚îÄ data/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ db/RecordingDatabase.kt              # Room DB
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ db/RecordingDao.kt                   # DAO
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ model/Recording.kt                   # Data model
‚îÇ       ‚îî‚îÄ‚îÄ ui/
‚îÇ           ‚îú‚îÄ‚îÄ MainActivity.kt
‚îÇ           ‚îî‚îÄ‚îÄ screens/                             # Compose screens
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ asr.yaml                       # ASR provider config
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îî‚îÄ‚îÄ *.sql                          # DB migrations
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile.api
‚îú‚îÄ‚îÄ .env                               # Secrets (–Ω–µ –≤ git)
‚îî‚îÄ‚îÄ CLAUDE.md                          # –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
```

---

## 15. –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (ORDERED BY PRIORITY)

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (—ç—Ç–∞ –Ω–µ–¥–µ–ª—è):
1. **Fix CoD** ‚Äî tiered chunking –≤ `digest/generator.py`
2. **–†—É—Å—Å–∫–∏–µ —Å—Ç–æ–ø-—Ñ—Ä–∞–∑—ã** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ `websocket.py` –∏ `enricher.py`
3. **topics/domains —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** ‚Äî ALTER TABLE + DomainClassifier —Å–∫–µ–ª–µ—Ç
4. **–£–±—Ä–∞—Ç—å SAFE checker warning** ‚Äî —Å–æ–∑–¥–∞—Ç—å `src/validation/safe_checker.py`

### –ù–∞ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–µ:
5. **Android offline queue** (WorkManager + Room PendingUpload)
6. **Retry –¥–ª—è async enrichment** (3 –ø–æ–ø—ã—Ç–∫–∏ exponential backoff)
7. **GPU ASR** (–µ—Å–ª–∏ Docker GPU passthrough —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ RTX 5070 Ti)
8. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ CoreMemory** –∏–∑ .cursor/ –≤ src/storage/

### –í —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞:
9. **Wheel of Balance API** + Android UI
10. **Supabase RLS** –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
11. **Stage-2 –ø–∞–º—è—Ç—å** (text-embedding-3-small + pgvector)
12. **openSMILE** –ø—Ä–æ—Å–æ–¥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ (3-6 –º–µ—Å—è—Ü–µ–≤):
13. **PersonGraph** (Graphiti + temporal KG)
14. **Health Connect** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—à–∞–≥–∏, —Å–æ–Ω, –ø—É–ª—å—Å)
15. **"100 –º—É–¥—Ä–µ—Ü–æ–≤"** ‚Äî –∞–Ω—Å–∞–º–±–ª—å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤
16. **Calendar API** –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è enrichment

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2026-02-25. –û–±–Ω–æ–≤–ª—è—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–∏–º–æ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.*
