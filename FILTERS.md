# Speech Filter ‚Äî –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ—á–∏ –∏ –æ—Ç—Å–µ—á–µ–Ω–∏–µ –º—É–∑—ã–∫–∏/—à—É–º–∞

–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—Å–µ—á–µ–Ω–∏—è –º—É–∑—ã–∫–∏, —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞ –∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ —à—É–º–∞.

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

VAD (Voice Activity Detection) —Å–∞–º –ø–æ —Å–µ–±–µ **–Ω–µ –æ—Ç–ª–∏—á–∞–µ—Ç –º—É–∑—ã–∫—É –æ—Ç —Ä–µ—á–∏** ‚Äî –æ–Ω –ª–∏—à—å –ª–æ–≤–∏—Ç —ç–Ω–µ—Ä–≥–∏—é –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≥–æ–ª–æ—Å–æ–ø–æ–¥–æ–±–Ω—ã—Ö –∑–≤—É–∫–æ–≤. –ü–æ—ç—Ç–æ–º—É –ª—é–±–æ–π –≥—Ä–æ–º–∫–∏–π –∑–≤—É–∫ (—Ç–µ–ª–µ–≤–∏–∑–æ—Ä, –º—É–∑—ã–∫–∞) –º–æ–∂–µ—Ç "–∑–∞–≤–µ—Å—Ç–∏" –∑–∞–ø–∏—Å—å.

**–†–µ—à–µ–Ω–∏–µ**: –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø–µ–∫—Ç—Ä –∞—É–¥–∏–æ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–∏–≥–Ω–∞–ª —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π —Ä–µ—á—å—é.

---

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–ø–µ–∫—Ç—Ä–∞

–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è —Ä–µ—á—å –∏–º–µ–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ **300-3400 –ì—Ü**. –ú—É–∑—ã–∫–∞ –æ–±—ã—á–Ω–æ –∏–º–µ–µ—Ç —à–∏—Ä–æ–∫–∏–π —Å–ø–µ–∫—Ç—Ä (20-20000 –ì—Ü) —Å –≤—ã—Å–æ–∫–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π –≤—ã—à–µ 4 –∫–ì—Ü.

**–ê–ª–≥–æ—Ä–∏—Ç–º**:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø–µ–∫—Ç—Ä —á–µ—Ä–µ–∑ FFT (librosa –∏–ª–∏ numpy)
2. –í—ã—á–∏—Å–ª—è–µ—Ç –¥–æ–ª—é —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Ä–µ—á–µ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ (300-3400 –ì—Ü)
3. –í—ã—á–∏—Å–ª—è–µ—Ç –¥–æ–ª—é —ç–Ω–µ—Ä–≥–∏–∏ –≤ –≤—ã—Å–æ–∫–∏—Ö —á–∞—Å—Ç–æ—Ç–∞—Ö (>4 –∫–ì—Ü)
4. **–†–µ—á—å** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –µ—Å–ª–∏:
   - –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Ä–µ—á–µ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ (‚â•40% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –ù–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏ –≤ –≤—ã—Å–æ–∫–∏—Ö —á–∞—Å—Ç–æ—Ç–∞—Ö (‚â§30% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

---

## üöÄ –í–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞

### 1. –í `.env` —Ñ–∞–π–ª–µ

```bash
# –í–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
FILTER_MUSIC=true

# –ú–µ—Ç–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (energy/none)
FILTER_METHOD=energy

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
FILTER_SPEECH_BAND_LOW=300
FILTER_SPEECH_BAND_HIGH=3400
FILTER_ENERGY_THRESHOLD=0.4
FILTER_HIGH_FREQ_THRESHOLD=0.3
```

### 2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–§–∏–ª—å—Ç—Ä —Ç—Ä–µ–±—É–µ—Ç `librosa` –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã (–Ω–æ –∏–º–µ–µ—Ç fallback –Ω–∞ numpy):

```bash
pip install librosa
```

–ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -e ".[dev]"
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### `FILTER_ENERGY_THRESHOLD` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.4)

–ü–æ—Ä–æ–≥ –¥–æ–ª–∏ —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Ä–µ—á–µ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0-1).

- **–ú–µ–Ω—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (0.3) ‚Üí –±–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä, –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –±–æ–ª—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
- **–ë–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (0.5) ‚Üí –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π —Ñ–∏–ª—å—Ç—Ä, –º–æ–∂–µ—Ç –æ—Ç—Å–µ–∫–∞—Ç—å —Ç–∏—Ö—É—é —Ä–µ—á—å

### `FILTER_HIGH_FREQ_THRESHOLD` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.3)

–ü–æ—Ä–æ–≥ –¥–æ–ª–∏ —ç–Ω–µ—Ä–≥–∏–∏ –≤—ã—à–µ 4 –∫–ì—Ü (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏).

- **–ú–µ–Ω—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (0.2) ‚Üí –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏
- **–ë–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (0.4) ‚Üí –±–æ–ª–µ–µ –º—è–≥–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### `FILTER_SPEECH_BAND_LOW` / `FILTER_SPEECH_BAND_HIGH`

–ì—Ä–∞–Ω–∏—Ü—ã —Ä–µ—á–µ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≤ –ì—Ü. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏: 300-3400 –ì—Ü.

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –í .env
FILTER_MUSIC=true
FILTER_METHOD=energy

# –ó–∞–ø—É—Å–∫ listener
python src/edge/listener.py http://127.0.0.1:8000
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —à—É–º–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í .env
FILTER_MUSIC=true
FILTER_ENERGY_THRESHOLD=0.5  # –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π —Ñ–∏–ª—å—Ç—Ä
FILTER_HIGH_FREQ_THRESHOLD=0.2  # –°–∏–ª—å–Ω–µ–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤—ã—Å–æ–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–∏—Ö–æ–π —Ä–µ—á–∏

```bash
# –í .env
FILTER_MUSIC=true
FILTER_ENERGY_THRESHOLD=0.35  # –ë–æ–ª–µ–µ –º—è–≥–∫–∏–π —Ñ–∏–ª—å—Ç—Ä
FILTER_HIGH_FREQ_THRESHOLD=0.35
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞

```bash
# –í .env
FILTER_MUSIC=false
```

–ò–ª–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –≤–æ–æ–±—â–µ.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞

### –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Python

```python
from src.edge.filters import is_speech_energy_filter
import soundfile as sf
import numpy as np

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ
audio, sr = sf.read("test_audio.wav")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
is_speech_result, metrics = is_speech_energy_filter(audio, sr)

print(f"–Ø–≤–ª—è–µ—Ç—Å—è —Ä–µ—á—å—é: {is_speech_result}")
print(f"–†–µ—á–µ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω: {metrics['speech_ratio']:.2%}")
print(f"–í—ã—Å–æ–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã: {metrics['high_freq_ratio']:.2%}")
```

---

## üìà –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–æ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä –≤–∫–ª—é—á—ë–Ω, –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:

```
[edge] segment_filtered_out: reason=high_freq_ratio=0.45, speech_ratio=0.25
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ–≥–º–µ–Ω—Ç –±—ã–ª –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –∫–∞–∫ –Ω–µ-—Ä–µ—á—å.

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫

- **speech_ratio** (0-1): –î–æ–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –≤ —Ä–µ—á–µ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
  - `>0.4` –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ä–µ—á—å
  - `<0.3` –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç –º—É–∑—ã–∫—É/—à—É–º

- **high_freq_ratio** (0-1): –î–æ–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –≤—ã—à–µ 4 –∫–ì—Ü
  - `>0.3` –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç –º—É–∑—ã–∫—É
  - `<0.2` –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ä–µ—á—å

---

## üî¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

1. **–° librosa** (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç STFT (Short-Time Fourier Transform)
   - –¢–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–ø–µ–∫—Ç—Ä–∞
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production

2. **–° numpy** (fallback):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç FFT —á–µ—Ä–µ–∑ numpy
   - –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –ú–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–π, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–û–±—Ä–∞–±–æ—Ç–∫–∞**: ~10-50ms –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã)
- **CPU**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (~5-10% –Ω–∞ –æ–¥–Ω–æ–º —è–¥—Ä–µ)
- **–ü–∞–º—è—Ç—å**: ~50MB –¥–ª—è librosa

---

## üöß –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –≠—Ç–∞–ø 2: Audio Scene Classification

–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª—ë–≥–∫–æ–π –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ (panns_inference) –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:
- Speech
- Music
- TV/Radio
- Noise

### –≠—Ç–∞–ø 3: Voice Signature

–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –≥–æ–ª–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç—Å–µ—á–µ–Ω–∏—è —á—É–∂–∏—Ö –≥–æ–ª–æ—Å–æ–≤.

---

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "librosa not available"

–§–∏–ª—å—Ç—Ä –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ fallback-—Ä–µ–∂–∏–º–µ —Å numpy. –î–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```bash
pip install librosa
```

### –§–∏–ª—å—Ç—Ä —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π (–æ—Ç—Å–µ–∫–∞–µ—Ç —Ä–µ—á—å)

–£–º–µ–Ω—å—à–∏—Ç–µ –ø–æ—Ä–æ–≥–∏:

```bash
FILTER_ENERGY_THRESHOLD=0.35
FILTER_HIGH_FREQ_THRESHOLD=0.35
```

### –§–∏–ª—å—Ç—Ä —Å–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–π (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –º—É–∑—ã–∫—É)

–£–≤–µ–ª–∏—á—å—Ç–µ –ø–æ—Ä–æ–≥–∏:

```bash
FILTER_ENERGY_THRESHOLD=0.5
FILTER_HIGH_FREQ_THRESHOLD=0.2
```

### –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É (fail-safe —Ä–µ–∂–∏–º), —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –∑–∞–ø–∏—Å—å.

---

## üìö –°—Å—ã–ª–∫–∏

- [librosa Documentation](https://librosa.org/doc/latest/index.html)
- [WebRTC VAD](https://github.com/wiseman/py-webrtcvad)
- [Speech Frequency Range](https://en.wikipedia.org/wiki/Voice_frequency)

---

**Reflexio Speech Filter –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç VAD –≤ —É–º–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä —Ä–µ—á–∏.** üéØ‚ú®













