name: level5-self-adaptive-upgrade
version: 1.0
description: >
  Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ¿Ğ³Ñ€ĞµĞ¹Ğ´ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Level 5 â€” Self-Adaptive.
  Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ DeepConf Feedback Loop, Adaptive Mission Scoring Ğ¸ Memory Curation Agent.

parameters:
  - name: auto_regenerate
    default: true
    description: "ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¸ÑÑĞ¸Ğ¸ Ñ Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¼ confidence"
  - name: curate_memory
    default: true
    description: "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ĞºÑƒÑ€Ğ°Ñ†Ğ¸Ñ Memory Bank"

steps:
  # ------------------------------------------------------------
  - name: Analyze Knowledge Health
    shell: bash
    run: |
      set -e
      echo "[level5-upgrade] ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ Ğ±Ğ°Ğ·Ñ‹ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹..."
      
      python -m src.osint.adaptive_scoring --analyze

  # ------------------------------------------------------------
  - name: Apply DeepConf Feedback Loop
    shell: bash
    run: |
      set -e
      echo "[level5-upgrade] ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ DeepConf Feedback Loop..."
      
      python -m src.osint.deepconf_feedback --apply

  # ------------------------------------------------------------
  - name: Auto-Regenerate Low Confidence Missions
    shell: bash
    when: "{{ auto_regenerate }}" == "true"
    run: |
      set -e
      echo "[level5-upgrade] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ñ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¸ÑÑĞ¸Ğ¹..."
      
      python - <<'PYCODE'
      import json
      from pathlib import Path
      
      # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
      metrics_file = Path("cursor-metrics.json")
      if metrics_file.exists():
          data = json.loads(metrics_file.read_text(encoding="utf-8"))
          osint = data.get("metrics", {}).get("osint", {})
          avg_confidence = osint.get("avg_deepconf_confidence")
          
          if avg_confidence is not None and avg_confidence < 0.8:
              print(f"[level5-upgrade] âš ï¸  Avg confidence below threshold: {avg_confidence:.2f}")
              print("[level5-upgrade] Consider regenerating missions")
          else:
              print("[level5-upgrade] âœ… Confidence metrics OK")
      PYCODE

  # ------------------------------------------------------------
  - name: Curate Memory Bank
    shell: bash
    when: "{{ curate_memory }}" == "true"
    run: |
      set -e
      echo "[level5-upgrade] ĞšÑƒÑ€Ğ°Ñ†Ğ¸Ñ Memory Bank..."
      
      python -m src.osint.memory_curator \
        --max-age 30 \
        --threshold 0.8 \
        --remove-refuted || echo "[level5-upgrade] âš ï¸  Curation completed with warnings"

  # ------------------------------------------------------------
  - name: Update Governance Profile
    shell: bash
    run: |
      set -e
      echo "[level5-upgrade] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Governance Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ..."
      
      python .cursor/metrics/governance_loop.py --apply results || true

  # ------------------------------------------------------------
  - name: Run Final Audit
    shell: bash
    run: |
      set -e
      echo "[level5-upgrade] Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°..."
      
      python .cursor/audit/run_audit.py --mode standard

  # ------------------------------------------------------------
  - name: Generate Level 5 Report
    shell: bash
    run: |
      set -e
      python - <<'PYCODE'
      import json
      from pathlib import Path
      from datetime import datetime
      
      audit_file = Path(".cursor/audit/audit_report.json")
      if audit_file.exists():
          data = json.loads(audit_file.read_text(encoding="utf-8"))
          score = data.get("score", 0)
          level = data.get("level", 0)
          
          print("\n" + "=" * 70)
          print("Level 5 Upgrade Complete")
          print("=" * 70)
          print(f"Current Score: {score} / 100")
          print(f"Current Level: {level} / 5")
          
          if score >= 90:
              print("\nâœ… REFLEXIO 24/7 ACHIEVED LEVEL 5 â€” SELF-ADAPTIVE!")
              print("\nThe system is now fully autonomous and self-adapting.")
          elif score >= 85:
              print("\nâš ï¸  Close to Level 5. Minor improvements needed.")
          else:
              print("\nğŸ“ˆ Progress towards Level 5. Continue optimization.")
          
          print("=" * 70 + "\n")
      PYCODE

  # ------------------------------------------------------------
  - name: Summary
    shell: bash
    run: |
      echo ""
      echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Level 5 Upgrade Complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
      echo ""
      echo "New capabilities:"
      echo "  âœ… DeepConf Feedback Loop â€” active"
      echo "  âœ… Adaptive Mission Scoring â€” enabled"
      echo "  âœ… Memory Curation Agent â€” ready"
      echo ""
      echo "Check:"
      echo "  - .cursor/audit/audit_report.json"
      echo "  - .cursor/governance/profile.yaml"
      echo ""
      echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"













