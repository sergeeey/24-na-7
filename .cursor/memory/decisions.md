# ADR: Architectural Decisions — Reflexio 24/7

### ADR-001: Архитектура

Выбран **модульный монолит** как баланс между простотой и масштабируемостью.  

Переход к микросервисам возможен без переписывания логики.

### ADR-002: ASR

Используем `faster-whisper small int8` локально.  

Причины: офлайн-работа, минимальная задержка, отсутствие затрат.  

Fallback — OpenAI Whisper API (по ключу).

### ADR-003: VAD

`webrtcvad` — лёгкий и надёжный.  

`silero-vad` оставлен как опциональный.

### ADR-004: Storage

Локально `SQLite`, в проде — `Supabase` (Postgres + Storage).  

Схема БД согласована с `/ingest` и `/digest`.

### ADR-005: Privacy

Zero-retention режим: аудио удаляется после успешной транскрибации.  

PII-маскирование — на уровне текста перед анализом.

### ADR-006: AI-анализ

Первая версия — текстовая: правила + LLM.  

Версия 2 — голосовые эмоции (SER), embeddings.

### ADR-007: Night routine

22:50 — дайджест  

23:10 — чек-ин (3 вопроса)  

Реализовано через Telegram-бот и API-вызовы.

### ADR-008: Fail-safe

Любой сбой в пайплайне → `Result.err()` и запись в `errors.log`.  

Аудио не сохраняется дольше 24 ч.

