# ADR 0003: Circuit Breakers для внешних сервисов

**Статус:** Принято  
**Дата:** 2024-02-17  
**Авторы:** Команда разработки

## Context

Система зависит от внешних сервисов (LLM провайдеры, Supabase, MCP сервисы). При сбоях этих сервисов возможны каскадные отказы всей системы.

## Decision

Реализован Circuit Breaker паттерн для защиты от каскадных отказов.

**Реализация:**
- Собственный модуль `src/utils/circuit_breaker.py`
- Применён к LLM провайдерам (OpenAI, Anthropic, Google)
- Применён к Supabase клиенту
- Применён к MCP сервисам (Brave Search, BrightData)

**Параметры:**
- `failure_threshold=5` - открытие после 5 ошибок
- `timeout=60s` - переход в HALF_OPEN через 60 секунд

## Consequences

**Положительные:**
- Защита от каскадных отказов
- Быстрый отказ при недоступности сервиса
- Автоматическое восстановление при восстановлении сервиса
- Логирование состояния для мониторинга

**Отрицательные:**
- Дополнительная сложность в коде
- Необходимость настройки параметров для каждого сервиса
- Возможные ложные срабатывания при временных проблемах сети
