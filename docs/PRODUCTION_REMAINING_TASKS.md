# üìã –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ Production ‚Äî Reflexio v2.1

**–î–∞—Ç–∞:** 4 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** Reflexio v2.1 "Surpass Smart Noter"  
**–û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** ~95%

---

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ (100%)

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –í—Å–µ 7 —ç–ø–∏–∫–æ–≤ —Å–ø—Ä–∏–Ω—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
- ‚úÖ ASR Layer (–æ—Ñ–ª–∞–π–Ω, –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º)
- ‚úÖ LLM & Reasoning (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑)
- ‚úÖ UX Layer (PDF, Telegram, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ Memory & Context (self-update, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- ‚úÖ Privacy & Governance (AES, RLS, Explainable AI)
- ‚úÖ Monetization (Freemium, Stripe, Referrals)
- ‚úÖ Documentation

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ Docker Compose
- ‚úÖ CI/CD pipeline (GitHub Actions)
- ‚úÖ Health checks
- ‚úÖ Prometheus metrics endpoint (`/metrics/prometheus`)
- ‚úÖ Observability (Prometheus, Grafana)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ SAFE + CoVe validation
- ‚úÖ AES-256 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- ‚úÖ Zero-retention policy

---

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (5% –æ—Å—Ç–∞–ª–æ—Å—å)

### üî¥ –ö–†–ò–¢–ò–ß–ù–û (–±–ª–æ–∫–µ—Ä—ã)

#### 1. Requirements.txt ‚Äî ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- ‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

#### 2. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î ‚Äî ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–ò–ú–ï–ù–ï–ù–ò–ï
**–ù–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è v2.1:**
- [ ] `0005_rls_activation.sql` ‚Äî –∞–∫—Ç–∏–≤–∞—Ü–∏—è RLS —Å tenant_id
- [ ] `0006_billing.sql` ‚Äî —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è billing
- [ ] `0007_referrals.sql` ‚Äî —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è referrals

**–ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å:**
1. –û—Ç–∫—Ä—ã—Ç—å Supabase Dashboard ‚Üí SQL Editor
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É (0005, 0006, 0007)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `@playbook db-migrate --verify`

#### 3. Prometheus Config ‚Äî ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- ‚úÖ `observability/prometheus.yml` –æ–±–Ω–æ–≤–ª—ë–Ω (`metrics_path: '/metrics/prometheus'`)

---

### üü° –í–ê–ñ–ù–û (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### 4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚Äî ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ù–ê–°–¢–†–û–ô–ö–ê

**–ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è v2.1 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
# Telegram (–¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤)
TELEGRAM_BOT_TOKEN=...
TELEGRAM_CHAT_ID=...

# Stripe (–¥–ª—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏)
STRIPE_SECRET_KEY=...
STRIPE_WEBHOOK_SECRET=...

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
AUDIO_ENCRYPTION_PASSWORD=...
AUDIO_ENCRYPTION_SALT=...

# Retention (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
AUDIO_RETENTION_HOURS=24
TRANSCRIPTION_RETENTION_DAYS=90
DIGEST_RETENTION_DAYS=365

# Letta SDK (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
LETTA_API_KEY=...
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python scripts/check_api_keys.py
```

#### 5. –¢–µ—Å—Ç—ã ‚Äî ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ó–ê–ü–£–°–ö

**–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã:**
```bash
pytest tests/ -v --cov=src --cov-report=term-missing
```

**–û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ:**
- `tests/test_rls.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ RLS (–≤–∫–ª—é—á–∞—è –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é 0005)
- `tests/test_migrations.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π (–≤–∫–ª—é—á–∞—è 0006, 0007)
- `tests/test_asr_offline.py` ‚Äî –æ—Ñ–ª–∞–π–Ω —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è

#### 6. Production Readiness Gates ‚Äî ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–û–í–ï–†–ö–ê

**–ó–∞–ø—É—Å—Ç–∏—Ç—å playbook:**
```bash
@playbook prod-readiness
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ API –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ Security validation –ø—Ä–æ—Ö–æ–¥–∏—Ç
- ‚úÖ Database connection —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Observability –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ LLM smoke test –ø—Ä–æ—Ö–æ–¥–∏—Ç

#### 7. Docker Build ‚Äî ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–û–í–ï–†–ö–ê

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É:**
```bash
docker compose build
docker compose up -d
docker compose ps
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
```bash
docker compose logs api
docker compose logs worker
docker compose logs scheduler
```

#### 8. Health Checks ‚Äî ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–û–í–ï–†–ö–ê

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoints:**
```bash
curl http://localhost:8000/health
curl http://localhost:8000/
curl http://localhost:8000/metrics/prometheus
```

---

### üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ–∑–∂–µ)

#### 9. Telegram Integration ‚Äî ‚ö†Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç—ã –≤ Telegram:**
1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –ü–æ–ª—É—á–∏—Ç—å `TELEGRAM_BOT_TOKEN`
3. –ü–æ–ª—É—á–∏—Ç—å `TELEGRAM_CHAT_ID`
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É

#### 10. Stripe Integration ‚Äî ‚ö†Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—é:**
1. –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –≤ Stripe
2. –ü–æ–ª—É—á–∏—Ç—å `STRIPE_SECRET_KEY`
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook endpoint
4. –ü–æ–ª—É—á–∏—Ç—å `STRIPE_WEBHOOK_SECRET`

#### 11. Retention Policy ‚Äî ‚ö†Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ retention policy —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
from src.storage.retention_policy import get_retention_policy
policy = get_retention_policy()
result = policy.cleanup_all()
print(result)
```

#### 12. Daily Digest Cron ‚Äî ‚ö†Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∞
python scripts/daily_digest_cron.py --once --date today

# –ò–ª–∏ —á–µ—Ä–µ–∑ scheduler
docker compose logs scheduler
```

---

## üìã –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ production

### Pre-Deployment (–∫—Ä–∏—Ç–∏—á–Ω–æ)

- [x] **requirements.txt —Å–æ–∑–¥–∞–Ω** ‚úÖ
- [x] **Prometheus config –æ–±–Ω–æ–≤–ª—ë–Ω** ‚úÖ
- [ ] **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω—ã** (0005, 0006, 0007) ‚ö†Ô∏è
- [ ] **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** ‚ö†Ô∏è
- [ ] **–¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç** ‚ö†Ô∏è
- [ ] **Security validation –ø—Ä–æ—Ö–æ–¥–∏—Ç** ‚ö†Ô∏è
- [ ] **Docker –æ–±—Ä–∞–∑—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è** ‚ö†Ô∏è

### Deployment

- [ ] **Docker Compose –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** ‚ö†Ô∏è
- [ ] **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–¥–æ—Ä–æ–≤—ã** (api, worker, scheduler) ‚ö†Ô∏è
- [ ] **Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏** ‚ö†Ô∏è
- [ ] **API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`** ‚ö†Ô∏è
- [ ] **API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/metrics/prometheus`** ‚ö†Ô∏è

### Post-Deployment

- [ ] **–¢–µ—Å—Ç–æ–≤—ã–π –∞—É–¥–∏–æ —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** ‚ö†Ô∏è
- [ ] **–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚ö†Ô∏è
- [ ] **–î–∞–π–¥–∂–µ—Å—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è** ‚ö†Ô∏è
- [ ] **Telegram –¥–∞–π–¥–∂–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω) ‚ö†Ô∏è
- [ ] **Retention policy —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚ö†Ô∏è

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

### –°–µ–π—á–∞—Å (–∫—Ä–∏—Ç–∏—á–Ω–æ):

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** (0005, 0006, 0007) ‚Äî 5 –º–∏–Ω—É—Ç
2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã** ‚Äî 10 –º–∏–Ω—É—Ç
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker build** ‚Äî 5 –º–∏–Ω—É—Ç

### –ü–æ—Ç–æ–º (–≤–∞–∂–Ω–æ):

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å production readiness gates**
6. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å deployment**

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:

7. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
8. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Stripe** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|-----------|--------|----------|
| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π | 90% |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| –¢–µ—Å—Ç—ã | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ | 85% |
| CI/CD | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | ‚úÖ –ì–æ—Ç–æ–≤–æ | 100% |

**–û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** ~95%

**–û—Å—Ç–∞–ª–æ—Å—å:** ~5% (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è production

```bash
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
# –û—Ç–∫—Ä—ã—Ç—å Supabase Dashboard ‚Üí SQL Editor
# –í—ã–ø–æ–ª–Ω–∏—Ç—å: 0005_rls_activation.sql, 0006_billing.sql, 0007_referrals.sql

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest tests/ -v

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å production readiness
@playbook prod-readiness

# 4. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å Docker
docker compose build
docker compose up -d

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health
curl http://localhost:8000/health
curl http://localhost:8000/metrics/prometheus
```

---

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:**
- `docs/PRODUCTION_FINAL_CHECKLIST.md` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç
- `PRODUCTION_LAUNCH_CHECKLIST.md` ‚Äî –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `DEPLOYMENT.md` ‚Äî —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é





